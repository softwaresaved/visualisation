<html>
    <head>
        <meta charset="UTF-8"></meta>
        <title>SSI - Demos - Fellows' Travels</title>
    </head>
    <style>
/* Sea */
svg {
    background: cyan;
}

.country {
    fill: red;
    stroke-width: 2;
    stroke: black;
}

.home {
    fill: green;
    stroke-width: 2;
    stroke: black;
}

.conf {
    fill: yellow;
    stroke-width: 2;
    stroke: black;
}

.travel {
    stroke-width: 5;
    stroke: gray;
}
    </style>

    <body>
        <h1>SSI - Demos - Fellows' Travels</h1>
        <div id="map"></div>
        <script src="node_modules/d3/d3.min.js" charset="utf-8"></script>
        <script>
var width = 960,
    height = 1160;

var projection = d3.geo.conicEqualArea()
    .center([0,55.4])
    .rotate([4.4,1])
    .scale(6000)
    .translate([width / 2, height / 2]);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("#map")
    .append("svg")
    .attr("width", width)
    .attr("height", height);

// Need the layers to control which elements are on top.
var mapLayer = svg.append('g');
var travelLayer = svg.append('g');

d3.json("uk.json", function(error, json_data) {
    if (error) {
        console.log(error);
        return false;
    }

    mapLayer.selectAll("path")
        .data(json_data.features)
        .enter()
        .append("path")
        .attr("d", path)
        .classed("country", true);
});

// Raw data from fellows.
var travels = [
{
    home: [-1.46, 53.37],
    conf: [-2.23, 53.46],
},
{
    home: [-1.46, 53.37],
    conf: [-0.11, 51.51],
},
{
    home: [-0.35, 51.80],
    conf: [-2.23, 53.46],
},
{
    home: [-4.13, 50.37],
    conf: [-2.23, 53.46],
},
];

// Convert geo coordinates to SVG coordinates.
geoTravels = travels.map(function(travel) {
    return {home: projection(travel.home), conf: projection(travel.conf) };
});

// Save data selection.
newTravels = travelLayer.selectAll("circle")
    .data(geoTravels)  // We are using the data with SVG coordinates.
    .enter();

newTravels.append('circle')  // Add circle. This is the only way.
    .attr('cx', function(d) { return d.home[0]; })
    .attr('cy', function(d) { return d.home[1]; })
    .attr('r', 15)
    .classed("home", true);

newTravels.append('circle')  // Add circle. This is the only way.
    .attr('cx', function(d) { return d.conf[0]; })
    .attr('cy', function(d) { return d.conf[1]; })
    .attr('r', 15)
    .classed("conf", true);

newTravels.append('line')  // Add line. This is the only way.
    .attr('x1', function(d) { return d.home[0]; })
    .attr('y1', function(d) { return d.home[1]; })
    .attr('x2', function(d) { return d.conf[0]; })
    .attr('y2', function(d) { return d.conf[1]; })
    .classed("travel", true);
        </script>
    </body>
</html>
