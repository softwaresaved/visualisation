<html>
    <head>
        <meta charset="UTF-8"></meta>
        <title>SSI - Demos - Fellows' Home Institution</title>
    </head>
    <style>
/* Sea */
svg {
    background: cyan;
}

.country {
    fill: red;
    stroke-width: 2;
    stroke: black;
}

.fellow {
    fill: green;
    stroke-width: 2;
    stroke: black;
}
    </style>
    <!-- Need to include this CSS to have tooltip -->
    <link href="node_modules/d3-tip/examples/example-styles.css" rel="stylesheet">

    <body>
        <h1>SSI - Demos - Fellows' Home Institution</h1>
        <div id="map"></div>
        <script src="node_modules/d3/d3.min.js" charset="utf-8"></script>
        <!-- Need to include this library to have tooltip -->
        <script src="node_modules/d3-tip/index.js" charset="utf-8"></script>
        <script>
var width = 960,
    height = 1160;

var projection = d3.geo.conicEqualArea()
    .center([0,55.4])
    .rotate([4.4,1])
    .scale(6000)
    .translate([width / 2, height / 2]);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("#map")
    .append("svg")
    .attr("width", width)
    .attr("height", height);

// Need the layers to control which elements are on top.
var mapLayer = svg.append('g');
var fellowLayer = svg.append('g');

d3.json("uk.json", function(error, json_data) {
    if (error) {
        console.log(error);
        return false;
    }

    mapLayer.selectAll("path")
        .data(json_data.features)
        .enter()
        .append("path")
        .attr("d", path)
        .classed("country", true);
});

// Raw data from fellows.
var fellows = [
{
    id: 1,
    lonlat: [-1.46, 53.37],
},
{
    id: 2,
    lonlat: [-0.35, 51.80],
},
{
    id: 3,
    lonlat: [-4.13, 50.37],
},
];

// Convert geo coordinates to SVG coordinates.
geoFellows = fellows.map(function(fellow) {
    return {id: fellow.id, lonlat: projection(fellow.lonlat) };
});

// Setup tooltip.
var fellowTip = d3.tip()
    .attr("class", "d3-tip")  // You can't use `.classed("d3-tip")` here!
    .html(function(d) {
        return d.id;
    });
svg.call(fellowTip);

// Add one circle for each fellow.
fellowLayer.selectAll("circle")
    .data(geoFellows)  // We are using the data with SVG coordinates.
    .enter()
    .append('circle')  // Add circle. This is the only way.
    .attr('cx', function(d) { return d.lonlat[0]; })
    .attr('cy', function(d) { return d.lonlat[1]; })
    .attr('r', 15)
    .classed("fellow", true)
    .on("mouseover", fellowTip.show)
    .on("mouseout", fellowTip.hide);
        </script>
    </body>
</html>
